<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Caribbean METAR – Live Weather</title>
  <style>
    body {
      background-color: #101820;
      color: #f2f2f2;
      margin: 0;
      font-family: 'Segoe UI', Verdana, sans-serif;
    }
    header {
      background: #00243a;
      padding: 30px;
      text-align: center;
      font-size: 2.3rem;
      font-weight: bold;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 40px auto;
      font-size: 1.3rem;
      min-width: 1150px;
    }
    th, td {
      padding: 16px;
      border: 1px solid #2a3b47;
      text-align: left;
    }
    th {
      background-color: #003b5a;
      color: white;
    }
    tr:hover {
      background-color: #1c2a35;
    }
    footer {
      background-color: #00243a;
      color: #ccc;
      text-align: center;
      padding: 20px;
      font-size: 1rem;
    }
    footer a {
      color: #8ecfff;
      text-decoration: none;
    }
  </style>
</head>
<body>

<header>Caribbean Airports – Live METAR</header>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>TNCA – Aruba</th>
      <th>TNCB – Bonaire</th>
      <th>TNCC – Curaçao</th>
      <th>TNCM – St. Maarten</th>
      <th>SVMI – Caracas</th>
    </tr>
  </thead>
  <tbody id="metar-data">
    <tr><td colspan="6">Loading METAR data...</td></tr>
  </tbody>
</table>

<footer>
  &copy; 2025 Caribbean Aviation Weather &nbsp;|&nbsp;
  <a href="https://www.meteo.cw" target="_blank">Visit Meteo Curaçao</a>
</footer>

<script>
  const stations = ['TNCA', 'TNCB', 'TNCC', 'TNCM', 'SVMI'];
  const apiKey = 'fb135a94c0574db4b26082b70705b4af';
  const tbody = document.getElementById('metar-data');

  async function fetchMetars() {
    try {
      const res = await fetch(`https://api.checkwx.com/metar/${stations.join(',')}/decoded`, {
        headers: { 'X-API-Key': apiKey }
      });
      const json = await res.json();

      const data = {};
      json.data.forEach(r => {
        const clouds = (r.clouds || []).map(c => {
          const base = c.base_feet_agl ? `${c.base_feet_agl} ft AGL` : '—';
          return `${c.text} (${base})`;
        }).join(', ') || '—';

        data[r.icao] = {
          time: r.observed || '—',
          temperature: r.temperature?.celsius + ' °C' || '—',
          dewpoint: r.dewpoint?.celsius + ' °C' || '—',
          wind: r.wind ? `${r.wind.degrees}° at ${r.wind.speed_kts} kt` : '—',
          visibility: r.visibility?.meters + ' m' || '—',
          conditions: r.conditions?.map(c => c.text).join(', ') || '—',
          clouds: clouds,
          qnh: r.barometer?.hpa + ' hPa' || '—'
        };
      });

      const parameters = ['time', 'temperature', 'dewpoint', 'wind', 'visibility', 'conditions', 'clouds', 'qnh'];
      const labels = {
        time: 'Time',
        temperature: 'Temperature',
        dewpoint: 'Dewpoint',
        wind: 'Wind',
        visibility: 'Visibility',
        conditions: 'Conditions',
        clouds: 'Clouds (Base Height)',
        qnh: 'QNH'
      };

      const rows = parameters.map(param => {
        return `<tr><td>${labels[param]}</td>` +
          stations.map(code => `<td>${data[code]?.[param] || '—'}</td>`).join('') +
          '</tr>';
      }).join('');

      tbody.innerHTML = rows;
    } catch (err) {
      console.error('Error loading METAR:', err);
      tbody.innerHTML = `<tr><td colspan="6">⚠️ Error loading data. Check connection or API key.</td></tr>`;
    }
  }

  fetchMetars();
  setInterval(fetchMetars, 5 * 60 * 1000); // Refresh every 5 min
</script>

</body>
</html>
